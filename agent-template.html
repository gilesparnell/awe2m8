<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Demo - AWE2M8</title>
    <link rel="stylesheet" href="css/demo-styles.css">
</head>

<body>
    <div class="header">
        <a href="https://awe2m8.ai" class="logo">
            <img src="images/AWE2M8Logo.png" alt="AWE2M8.ai">
        </a>
        <a href="index.html" class="back-btn">← Back to Demos</a>
    </div>

    <div class="hero">
        <h1 id="hero-title">Loading...</h1>
        <p id="hero-description">Loading...</p>
    </div>

    <div class="three-column-grid">
        <!-- COLUMN 1: CTA / VOICE DEMO (First on mobile) -->
        <div class="column-box">
            <div class="cta-in-column">
                <div class="cta-emoji" id="cta-emoji"></div>
                <h2 id="cta-title">Loading...</h2>
                <div style="display: flex; justify-content: center; align-items: center; width: 100%; margin: 20px 0;">
                    <iframe id="demo-iframe" src="" allow="microphone"
                        style="width: 100%; max-width: 300px; height: 200px; border: none; display: none;"></iframe>
                    <a id="demo-link" href="#" target="_blank" class="card-link" style="display: none;">Try It Now →</a>
                </div>
                <p id="cta-description" style="margin: 0; font-size: 0.9em; opacity: 0.8;">Loading...</p>
            </div>
        </div>

        <!-- COLUMN 2: VIDEO (Second on mobile) -->
        <div class="column-box">
            <h2>See It In Action</h2>
            <div class="video-in-column" id="video-container">
                <p style="padding: 20px; text-align: center; opacity: 0.6;">No video available for this agent.</p>
            </div>
        </div>

        <!-- COLUMN 3: HOW IT WORKS (Third on mobile) -->
        <div class="column-box">
            <h3>How It Works</h3>
            <p id="how-it-works">Loading...</p>
        </div>
    </div>

    <!-- FULL WIDTH: WHY IT MATTERS (Last on mobile) -->
    <div class="full-width-section">
        <div class="column-box">
            <h3>Why This Matters</h3>
            <p id="why-it-matters">Loading...</p>
        </div>
    </div>

    <script>
        // Helper to get query params
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const agentId = getQueryParam('id');

        if (!agentId) {
            document.body.innerHTML = '<h1 style="color:white; text-align:center; margin-top:50px;">Error: No agent ID specified</h1>';
        } else {
            fetch('content/content.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Content file not found');
                    }
                    return response.json();
                })
                .then(data => {
                    const content = data[agentId];

                    if (!content) {
                        document.body.innerHTML = `<h1 style="color:white; text-align:center; margin-top:50px;">Error: Agent "${agentId}" not found</h1>`;
                        return;
                    }

                    document.title = `${content.title} Demo - AWE2M8`;
                    document.getElementById('hero-title').innerHTML = `${content.emoji} ${content.title}`;
                    document.getElementById('hero-description').textContent = content.heroDescription;
                    document.getElementById('how-it-works').textContent = content.howItWorks;
                    document.getElementById('why-it-matters').innerHTML = content.whyItMatters;
                    document.getElementById('cta-emoji').textContent = content.emoji;
                    document.getElementById('cta-title').textContent = content.ctaButtonText;
                    document.getElementById('cta-description').textContent = content.ctaDescription;

                    // Handle Iframe vs Link
                    const iframe = document.getElementById('demo-iframe');
                    const link = document.getElementById('demo-link');

                    if (content.iframeUrl && content.iframeUrl.trim() !== '') {
                        iframe.src = content.iframeUrl;
                        iframe.style.display = 'block';
                    } else if (content.demoUrl && content.demoUrl.trim() !== '') {
                        link.href = content.demoUrl;
                        link.style.display = 'inline-block';
                    }

                    // Handle Video
                    if (content.videoUrl && content.videoUrl.trim() !== '') {
                        document.getElementById('video-container').innerHTML = `
                        <iframe 
                            src="${content.videoUrl}" 
                            allow="autoplay"
                            style="width: 100%; height: 100%; border: none;"
                        ></iframe>
                    `;
                    }
                })
                .catch(error => {
                    console.error('Error loading content:', error);
                    document.getElementById('hero-description').textContent = 'Error loading content. Please refresh the page.';
                });
        }

        // Microphone permission check for iframes
        const frame = document.getElementById('demo-iframe');
        frame.addEventListener('load', () => {
            if (navigator.permissions) {
                navigator.permissions.query({ name: 'microphone' })
                    .then(result => {
                        if (result.state === 'granted') {
                            console.log('Microphone access already granted');
                        }
                    });
            }
        });
    </script>
    <script src="js/interactive-base.js"></script>
    <script src="js/dark-mode.js"></script>
    <script src="js/core-effects.js"></script>
</body>

</html>
