<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWE2M8 Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(-45deg, #0a0a0a, #001a00, #003300, #0a0a0a);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: white;
            padding: 20px;
            min-height: 100vh;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #ffffff;
            font-size: 2.5rem;
            text-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
            font-weight: 800;
        }

        .subtitle {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 30px;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #00ff00, #00cc00);
            color: #000;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 255, 0, 0.5);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .summary {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid rgba(0, 255, 0, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-number {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .summary-number.pass {
            color: #00ff00;
        }

        .summary-number.fail {
            color: #ff4444;
        }

        .summary-number.warn {
            color: #ffaa00;
        }

        .summary-number.total {
            color: #ffffff;
        }

        .summary-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .test-category {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid rgba(0, 255, 0, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .category-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #00ff00;
        }

        .category-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .category-status.passed {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }

        .category-status.failed {
            background: rgba(255, 0, 0, 0.2);
            color: #ff4444;
        }

        .category-status.warning {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }

        .category-status.running {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .test-results {
            display: none;
        }

        .test-results.show {
            display: block;
        }

        .test-item {
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-item.pass {
            border-color: #00ff00;
        }

        .test-item.fail {
            border-color: #ff4444;
        }

        .test-item.warn {
            border-color: #ffaa00;
        }

        .test-name {
            flex: 1;
        }

        .test-status {
            font-weight: 600;
            padding: 3px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
        }

        .test-status.pass {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }

        .test-status.fail {
            background: rgba(255, 0, 0, 0.2);
            color: #ff4444;
        }

        .test-status.warn {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }

        .test-details {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .test-error {
            color: #ff4444;
            margin-top: 5px;
            font-family: monospace;
            font-size: 0.8rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00cc00);
            width: 0%;
            transition: width 0.3s ease;
        }

        .export-section {
            text-align: center;
            margin-top: 30px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .summary {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üß™ AWE2M8 Test Suite</h1>
        <p class="subtitle">Pre-commit validation & health check</p>

        <div class="controls">
            <button id="runAllTests">‚ñ∂Ô∏è Run All Tests</button>
            <button id="runQuickTests">‚ö° Quick Tests Only</button>
            <button id="exportReport" disabled>üìÑ Export Report</button>
            <button id="clearResults">üóëÔ∏è Clear Results</button>
        </div>

        <div class="progress-bar hidden" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="summary hidden" id="summary">
            <div class="summary-item">
                <div class="summary-number total" id="totalTests">0</div>
                <div class="summary-label">Total Tests</div>
            </div>
            <div class="summary-item">
                <div class="summary-number pass" id="passedTests">0</div>
                <div class="summary-label">Passed</div>
            </div>
            <div class="summary-item">
                <div class="summary-number fail" id="failedTests">0</div>
                <div class="summary-label">Failed</div>
            </div>
            <div class="summary-item">
                <div class="summary-number warn" id="warningTests">0</div>
                <div class="summary-label">Warnings</div>
            </div>
        </div>

        <div id="testResults"></div>

        <div class="export-section hidden" id="exportSection">
            <p style="color: rgba(255, 255, 255, 0.6); margin-bottom: 10px;">
                ‚úì All critical tests passed. Safe to commit!
            </p>
        </div>
    </div>

    <script>
        // Test Configuration
        const testConfig = {
            contentJsonPaths: [
                '../content/content.json',
                './content/content.json',
                '/content/content.json',
                'content.json'
            ],
            requiredIndustries: ['fireSafety', 'gyms'],
            requiredDemos: ['voiceAI', 'aiReceptionist', 'databaseReactivation'],
            criticalFields: {
                industry: ['pageTitle', 'heroTitle', 'heroSubtitle', 'solution1Title', 'smsAgentDemoUrl'],
                demo: ['title', 'emoji', 'heroDescription']
            }
        };

        // Test Results Storage
        let testResults = {
            categories: [],
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        // Test Categories
        const testCategories = [
            {
                name: 'JSON Structure Tests',
                quick: true,
                tests: [
                    { name: 'content.json exists and is accessible', fn: testContentJsonExists },
                    { name: 'JSON is valid and parseable', fn: testJsonValid },
                    { name: 'Required top-level structure exists', fn: testTopLevelStructure },
                    { name: 'Industries object exists', fn: testIndustriesExists },
                    { name: 'Required industries are present', fn: testRequiredIndustries }
                ]
            },
            {
                name: 'Data Integrity Tests',
                quick: true,
                tests: [
                    { name: 'All industry pages have required fields', fn: testIndustryFields },
                    { name: 'All URLs are valid format', fn: testUrlFormats },
                    { name: 'No empty critical fields', fn: testNoEmptyFields },
                    { name: 'Emoji fields contain valid emojis', fn: testEmojiFields }
                ]
            },
            {
                name: 'Link Validation Tests',
                quick: false,
                tests: [
                    { name: 'SMS demo links are accessible', fn: testSmsLinksAccessible },
                    { name: 'Orb iframe URLs are valid', fn: testOrbUrlsValid },
                    { name: 'Video URLs are accessible', fn: testVideoUrls }
                ]
            },
            {
                name: 'HTML File Tests',
                quick: true,
                tests: [
                    { name: 'Fire Safety HTML has required IDs', fn: testFireSafetyHtmlIds },
                    { name: 'Content editor HTML structure is valid', fn: testContentEditorStructure }
                ]
            },
            {
                name: 'Integration Tests',
                quick: false,
                tests: [
                    { name: 'Fire Safety page loads content correctly', fn: testFireSafetyIntegration },
                    { name: 'Content editor can read JSON', fn: testContentEditorIntegration }
                ]
            }
        ];

        let contentData = null;

        // ===== TEST IMPLEMENTATIONS =====

        async function testContentJsonExists() {
            for (const path of testConfig.contentJsonPaths) {
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        contentData = await response.json();
                        return { pass: true, message: `Found at: ${path}` };
                    }
                } catch (error) {
                    // Continue to next path
                }
            }
            return { pass: false, message: 'content.json not found in any expected location' };
        }

        async function testJsonValid() {
            if (!contentData) {
                return { pass: false, message: 'No JSON data loaded' };
            }
            try {
                JSON.stringify(contentData);
                return { pass: true, message: 'JSON is valid' };
            } catch (error) {
                return { pass: false, message: `JSON parse error: ${error.message}` };
            }
        }

        async function testTopLevelStructure() {
            if (!contentData) {
                return { pass: false, message: 'No data to test' };
            }
            const hasContent = Object.keys(contentData).length > 0;
            return {
                pass: hasContent,
                message: hasContent ? `${Object.keys(contentData).length} top-level keys found` : 'No content found'
            };
        }

        async function testIndustriesExists() {
            if (!contentData) {
                return { pass: false, message: 'No data to test' };
            }
            const exists = contentData.industries && typeof contentData.industries === 'object';
            return {
                pass: exists,
                message: exists ? 'Industries object found' : 'Industries object missing'
            };
        }

        async function testRequiredIndustries() {
            if (!contentData || !contentData.industries) {
                return { pass: false, message: 'No industries data' };
            }
            const missing = testConfig.requiredIndustries.filter(ind => !contentData.industries[ind]);
            if (missing.length > 0) {
                return { pass: false, message: `Missing industries: ${missing.join(', ')}` };
            }
            return { pass: true, message: `All ${testConfig.requiredIndustries.length} required industries present` };
        }

        async function testIndustryFields() {
            if (!contentData || !contentData.industries) {
                return { pass: false, message: 'No industries data' };
            }
            const issues = [];
            for (const [industryName, industryData] of Object.entries(contentData.industries)) {
                for (const field of testConfig.criticalFields.industry) {
                    if (!industryData[field]) {
                        issues.push(`${industryName}.${field} is missing`);
                    }
                }
            }
            if (issues.length > 0) {
                return { pass: false, message: issues.join(', '), warning: issues.length < 3 };
            }
            return { pass: true, message: 'All critical fields present' };
        }

        async function testUrlFormats() {
            if (!contentData) {
                return { pass: false, message: 'No data to test' };
            }
            const urlPattern = /^https?:\/\/.+/;
            const issues = [];

            function checkUrls(obj, path = '') {
                for (const [key, value] of Object.entries(obj)) {
                    if (key.toLowerCase().includes('url') && value && typeof value === 'string' && value !== '') {
                        if (!urlPattern.test(value)) {
                            issues.push(`${path}.${key}: "${value}" is not a valid URL`);
                        }
                    } else if (typeof value === 'object' && value !== null) {
                        checkUrls(value, path ? `${path}.${key}` : key);
                    }
                }
            }

            checkUrls(contentData);

            if (issues.length > 0) {
                return { pass: false, message: issues.slice(0, 3).join('; '), warning: true };
            }
            return { pass: true, message: 'All URL formats are valid' };
        }

        async function testNoEmptyFields() {
            if (!contentData) {
                return { pass: false, message: 'No data to test' };
            }
            const emptyFields = [];

            function checkEmpty(obj, path = '') {
                for (const [key, value] of Object.entries(obj)) {
                    const currentPath = path ? `${path}.${key}` : key;
                    if (typeof value === 'string' && value.trim() === '') {
                        emptyFields.push(currentPath);
                    } else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        checkEmpty(value, currentPath);
                    }
                }
            }

            checkEmpty(contentData);

            if (emptyFields.length > 0) {
                return { pass: false, message: `${emptyFields.length} empty fields found`, warning: true };
            }
            return { pass: true, message: 'No empty fields detected' };
        }

        async function testEmojiFields() {
            if (!contentData) {
                return { pass: false, message: 'No data to test' };
            }
            const emojiPattern = /\p{Emoji}/u;
            const issues = [];

            for (const [key, value] of Object.entries(contentData)) {
                if (value && value.emoji && !emojiPattern.test(value.emoji)) {
                    issues.push(`${key}.emoji is not a valid emoji`);
                }
            }

            if (issues.length > 0) {
                return { pass: false, message: issues.join(', '), warning: true };
            }
            return { pass: true, message: 'All emoji fields valid' };
        }

        async function testSmsLinksAccessible() {
            if (!contentData || !contentData.industries) {
                return { pass: false, message: 'No industries data' };
            }
            const issues = [];
            for (const [name, data] of Object.entries(contentData.industries)) {
                if (data.smsAgentDemoUrl) {
                    try {
                        const response = await fetch(data.smsAgentDemoUrl, { method: 'HEAD', mode: 'no-cors' });
                        // Note: With no-cors, we can't check status, but at least we verify URL format
                    } catch (error) {
                        issues.push(`${name}: ${error.message}`);
                    }
                }
            }
            return { pass: true, message: 'SMS links format checked (full accessibility requires server)', warning: true };
        }

        async function testOrbUrlsValid() {
            if (!contentData) {
                return { pass: false, message: 'No data to test' };
            }
            const orbUrlPattern = /iframes\.ai/;
            const issues = [];

            function checkOrbUrls(obj, path = '') {
                for (const [key, value] of Object.entries(obj)) {
                    if (key.toLowerCase().includes('orb') && key.toLowerCase().includes('url') && value) {
                        if (!orbUrlPattern.test(value)) {
                            issues.push(`${path}.${key} doesn't appear to be a valid Orb URL`);
                        }
                    } else if (typeof value === 'object' && value !== null) {
                        checkOrbUrls(value, path ? `${path}.${key}` : key);
                    }
                }
            }

            checkOrbUrls(contentData);

            if (issues.length > 0) {
                return { pass: false, message: issues.join('; '), warning: true };
            }
            return { pass: true, message: 'All Orb URLs appear valid' };
        }

        async function testVideoUrls() {
            if (!contentData) {
                return { pass: false, message: 'No data to test' };
            }
            const videoUrlPattern = /(youtube\.com|youtu\.be|vimeo\.com|drive\.google\.com)/;
            let videoCount = 0;

            function countVideos(obj) {
                for (const [key, value] of Object.entries(obj)) {
                    if (key.toLowerCase().includes('video') && key.toLowerCase().includes('url') && value) {
                        videoCount++;
                    } else if (typeof value === 'object' && value !== null) {
                        countVideos(value);
                    }
                }
            }

            countVideos(contentData);

            return { pass: true, message: `${videoCount} video URLs found`, warning: videoCount === 0 };
        }

        async function testFireSafetyHtmlIds() {
            // This would need actual HTML file access
            // For now, we'll return a placeholder
            return { pass: true, message: 'HTML ID check requires file system access', warning: true };
        }

        async function testContentEditorStructure() {
            return { pass: true, message: 'Editor structure check requires file system access', warning: true };
        }

        async function testFireSafetyIntegration() {
            if (!contentData || !contentData.industries || !contentData.industries.fireSafety) {
                return { pass: false, message: 'Fire Safety data missing' };
            }
            const fs = contentData.industries.fireSafety;
            const hasRequiredFields = fs.heroTitle && fs.smsAgentDemoUrl && fs.solution1Title;
            return {
                pass: hasRequiredFields,
                message: hasRequiredFields ? 'Fire Safety integration ready' : 'Missing required Fire Safety fields'
            };
        }

        async function testContentEditorIntegration() {
            if (!contentData) {
                return { pass: false, message: 'Cannot test without JSON data' };
            }
            return { pass: true, message: 'JSON is readable by editor' };
        }

        // ===== TEST RUNNER =====

        async function runTests(quickOnly = false) {
            // Reset
            testResults = { categories: [], total: 0, passed: 0, failed: 0, warnings: 0 };
            contentData = null;

            const resultsContainer = document.getElementById('testResults');
            resultsContainer.innerHTML = '';

            document.getElementById('summary').classList.remove('hidden');
            document.getElementById('progressBar').classList.remove('hidden');
            document.getElementById('exportSection').classList.add('hidden');

            const categoriesToRun = quickOnly
                ? testCategories.filter(cat => cat.quick)
                : testCategories;

            const totalTests = categoriesToRun.reduce((sum, cat) => sum + cat.tests.length, 0);
            let completedTests = 0;

            for (const category of categoriesToRun) {
                const categoryResult = await runCategory(category, (progress) => {
                    completedTests++;
                    updateProgress(completedTests, totalTests);
                });
                testResults.categories.push(categoryResult);
            }

            updateSummary();
            document.getElementById('progressBar').classList.add('hidden');
            document.getElementById('exportReport').disabled = false;

            if (testResults.failed === 0) {
                document.getElementById('exportSection').classList.remove('hidden');
            }
        }

        async function runCategory(category, onProgress) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'test-category';
            categoryDiv.innerHTML = `
                <div class="category-header">
                    <div class="category-title">${category.name}</div>
                    <div class="category-status running">Running...</div>
                </div>
                <div class="test-results"></div>
            `;
            document.getElementById('testResults').appendChild(categoryDiv);

            const resultsDiv = categoryDiv.querySelector('.test-results');
            const statusDiv = categoryDiv.querySelector('.category-status');

            const results = {
                name: category.name,
                passed: 0,
                failed: 0,
                warnings: 0,
                tests: []
            };

            for (const test of category.tests) {
                const result = await test.fn();
                testResults.total++;

                let status = 'pass';
                if (!result.pass) {
                    status = result.warning ? 'warn' : 'fail';
                    if (result.warning) {
                        results.warnings++;
                        testResults.warnings++;
                    } else {
                        results.failed++;
                        testResults.failed++;
                    }
                } else {
                    if (result.warning) {
                        results.warnings++;
                        testResults.warnings++;
                        status = 'warn';
                    } else {
                        results.passed++;
                        testResults.passed++;
                    }
                }

                results.tests.push({ name: test.name, ...result, status });

                const testDiv = document.createElement('div');
                testDiv.className = `test-item ${status}`;
                testDiv.innerHTML = `
                    <div class="test-name">
                        ${test.name}
                        ${result.message ? `<div class="test-details">${result.message}</div>` : ''}
                    </div>
                    <div class="test-status ${status}">
                        ${status === 'pass' ? '‚úì PASS' : status === 'warn' ? '‚ö† WARN' : '‚úó FAIL'}
                    </div>
                `;
                resultsDiv.appendChild(testDiv);

                onProgress();
            }

            // Update category status
            let categoryStatus = 'passed';
            if (results.failed > 0) categoryStatus = 'failed';
            else if (results.warnings > 0) categoryStatus = 'warning';

            statusDiv.className = `category-status ${categoryStatus}`;
            statusDiv.textContent = `${results.passed}/${category.tests.length} passed`;

            resultsDiv.classList.add('show');

            // Make category collapsible
            categoryDiv.querySelector('.category-header').addEventListener('click', () => {
                resultsDiv.classList.toggle('show');
            });

            return results;
        }

        function updateProgress(completed, total) {
            const percent = (completed / total) * 100;
            document.getElementById('progressFill').style.width = `${percent}%`;
        }

        function updateSummary() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('warningTests').textContent = testResults.warnings;
        }

        function exportReport() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: testResults.total,
                    passed: testResults.passed,
                    failed: testResults.failed,
                    warnings: testResults.warnings,
                    passRate: ((testResults.passed / testResults.total) * 100).toFixed(2) + '%'
                },
                categories: testResults.categories
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-report-${timestamp}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').classList.add('hidden');
            document.getElementById('exportSection').classList.add('hidden');
            document.getElementById('exportReport').disabled = true;
            testResults = { categories: [], total: 0, passed: 0, failed: 0, warnings: 0 };
        }

        // Event Listeners
        document.getElementById('runAllTests').addEventListener('click', () => runTests(false));
        document.getElementById('runQuickTests').addEventListener('click', () => runTests(true));
        document.getElementById('exportReport').addEventListener('click', exportReport);
        document.getElementById('clearResults').addEventListener('click', clearResults);
    </script>
</body>

</html>